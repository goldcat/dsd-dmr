#include <math.h>

// DMR filter
// Filter details ..
// filtertype	 =	 Raised Cosine
// samplerate	 =	 48000
// corner	 =	 2400
// beta	 =	 0.2 
// impulselen	 =	 81
// racos	 =	 sqrt
// comp	 =	 no
#define NZEROS 80
static float xv[NZEROS+1];

#if 0
float ngain = 0.124751567623;
float xcoeffs[] = {
  +0.0273676736, +0.0190682959, +0.0070661879, -0.0075385898,
  -0.0231737159, -0.0379433607, -0.0498333862, -0.0569528373,
  -0.0577853377, -0.0514204905, -0.0377352004, -0.0174982391,
  +0.0076217868, +0.0351552125, +0.0620353691, +0.0848941519,
  +0.1004237235, +0.1057694293, +0.0989127431, +0.0790009892,
  +0.0465831968, +0.0037187043, -0.0460635022, -0.0979622825,
  -0.1462501260, -0.1847425896, -0.2073523972, -0.2086782295,
  -0.1845719273, -0.1326270847, -0.0525370892, +0.0537187153,
  +0.1818868577, +0.3256572849, +0.4770745929, +0.6271117870,
  +0.7663588857, +0.8857664963, +0.9773779594, +1.0349835419,
  +1.0546365475, +1.0349835419, +0.9773779594, +0.8857664963,
  +0.7663588857, +0.6271117870, +0.4770745929, +0.3256572849,
  +0.1818868577, +0.0537187153, -0.0525370892, -0.1326270847,
  -0.1845719273, -0.2086782295, -0.2073523972, -0.1847425896,
  -0.1462501260, -0.0979622825, -0.0460635022, +0.0037187043,
  +0.0465831968, +0.0790009892, +0.0989127431, +0.1057694293,
  +0.1004237235, +0.0848941519, +0.0620353691, +0.0351552125,
  +0.0076217868, -0.0174982391, -0.0377352004, -0.0514204905,
  -0.0577853377, -0.0569528373, -0.0498333862, -0.0379433607,
  -0.0231737159, -0.0075385898, +0.0070661879, +0.0190682959,
  +0.0273676736
};
#else
float ngain = 0.1013334371128245f;
static float xcoeffs[] = {
    -0.0169677571, -0.0145395039, -0.0082010780, +0.0012496787,
    +0.0122014225, +0.0224665081, +0.0296710630, +0.0317346785,
    +0.0273511315, +0.0163715495, +0.0000002060, -0.0192593094,
    -0.0379271250, -0.0521080358, -0.0582091176, -0.0536933981,
    -0.0377286804, -0.0115949557, +0.0212558229, +0.0555408406,
    +0.0848738155, +0.1027925800, +0.1039381492, +0.0851948454,
    +0.0465892173, -0.0082321134, -0.0720703408, -0.1348320213,
    -0.1847260458, -0.2098573947, -0.2000000294, -0.1482872076,
    -0.0525533068, +0.0839004235, +0.2522672371, +0.4389705454,
    +0.6271054537, +0.7984086962, +0.9354944353, +1.0240464546,
    +1.0546566682, +1.0240464546, +0.9354944353, +0.7984086962,
    +0.6271054537, +0.4389705454, +0.2522672371, +0.0839004235,
    -0.0525533068, -0.1482872076, -0.2000000294, -0.2098573947,
    -0.1847260458, -0.1348320213, -0.0720703408, -0.0082321134,
    +0.0465892173, +0.0851948454, +0.1039381492, +0.1027925800,
    +0.0848738155, +0.0555408406, +0.0212558229, -0.0115949557,
    -0.0377286804, -0.0536933981, -0.0582091176, -0.0521080358,
    -0.0379271250, -0.0192593094, +0.0000002060, +0.0163715495,
    +0.0273511315, +0.0317346785, +0.0296710630, +0.0224665081,
    +0.0122014225, +0.0012496787, -0.0082010780, -0.0145395039,
    -0.0169677571,
};
#endif

// NXDN filter
#define NXZEROS 134
float nxgain = 0.062659371644565f;

static float nxv[NXZEROS+1];

static float nxcoeffs[] = {
  +0.031462429, +0.031747267, +0.030401148, +0.027362877,
  +0.022653298, +0.016379869, +0.008737200, +0.000003302,
  -0.009468531, -0.019262057, -0.028914291, -0.037935027,
  -0.045828927, -0.052119261, -0.056372283, -0.058221106,
  -0.057387924, -0.053703443, -0.047122444, -0.037734535,
  -0.025769308, -0.011595336, +0.004287292, +0.021260954,
  +0.038610717, +0.055550276, +0.071252765, +0.084885375,
  +0.095646450, +0.102803611, +0.105731303, +0.103946126,
  +0.097138329, +0.085197939, +0.068234131, +0.046586711,
  +0.020828821, -0.008239664, -0.039608255, -0.072081234,
  -0.104311776, -0.134843790, -0.162160200, -0.184736015,
  -0.201094346, -0.209863285, -0.209831516, -0.200000470,
  -0.179630919, -0.148282051, -0.105841323, -0.052543664,
  +0.011020985, +0.083912428, +0.164857408, +0.252278939,
  +0.344336996, +0.438979335, +0.534000832, +0.627109358,
  +0.715995947, +0.798406824, +0.872214756, +0.935487176,
  +0.986548646, +1.024035395, +1.046939951, +1.054644241,
  +1.046939951, +1.024035395, +0.986548646, +0.935487176,
  +0.872214756, +0.798406824, +0.715995947, +0.627109358,
  +0.534000832, +0.438979335, +0.344336996, +0.252278939,
  +0.164857408, +0.083912428, +0.011020985, -0.052543664,
  -0.105841323, -0.148282051, -0.179630919, -0.200000470,
  -0.209831516, -0.209863285, -0.201094346, -0.184736015,
  -0.162160200, -0.134843790, -0.104311776, -0.072081234,
  -0.039608255, -0.008239664, +0.020828821, +0.046586711,
  +0.068234131, +0.085197939, +0.097138329, +0.103946126,
  +0.105731303, +0.102803611, +0.095646450, +0.084885375,
  +0.071252765, +0.055550276, +0.038610717, +0.021260954,
  +0.004287292, -0.011595336, -0.025769308, -0.037734535,
  -0.047122444, -0.053703443, -0.057387924, -0.058221106,
  -0.056372283, -0.052119261, -0.045828927, -0.037935027,
  -0.028914291, -0.019262057, -0.009468531, +0.000003302,
  +0.008737200, +0.016379869, +0.022653298, +0.027362877,
  +0.030401148, +0.031747267, +0.031462429
};

short
dmr_filter(short sample)
{
  float sum = 0.0f;
  unsigned int i;

  for (i = 0; i < NZEROS; i++)
    xv[i] = xv[i+1];

  xv[NZEROS] = sample; // unfiltered sample in

  for (i = 0; i <= NZEROS; i++)
    sum += (xcoeffs[i] * xv[i]);

  return lrintf(sum * ngain); // filtered sample out
}

short
nxdn_filter(short sample)
{
  float sum = 0.0f;
  unsigned int i;

  for (i = 0; i < NXZEROS; i++)
    nxv[i] = nxv[i+1];

  nxv[NXZEROS] = sample; // unfiltered sample in

  for (i = 0; i <= NXZEROS; i++)
    sum += (nxcoeffs[i] * nxv[i]);

  return lrintf(sum * nxgain); // filtered sample out
}

